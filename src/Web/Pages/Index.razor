@page "/"
@inject IJSRuntime JS

<h3>Photometric Tools</h3>

<p>
    Upload an IES file to convert it to TM-33 format.
</p>

<InputFile OnChange="OnFileSelected" />

@if (!string.IsNullOrEmpty(StatusMessage))
{
    <p>@StatusMessage</p>
}

@if (iesBytes != null)
{
    <button @onclick="ConvertToTm33">
        Convert to TM-33
    </button>
}

@code {

    private string? StatusMessage;
    private byte[]? iesBytes;

    private async Task OnFileSelected(InputFileChangeEventArgs e)
    {
        try
        {
            var file = e.File;
            StatusMessage = $"Selected file: {file.Name} ({file.Size} bytes)";

            using var stream = file.OpenReadStream(maxAllowedSize: 10 * 1024 * 1024);
            using var ms = new MemoryStream();
            await stream.CopyToAsync(ms);

            iesBytes = ms.ToArray();

            await JS.InvokeVoidAsync(
                "console.log",
                $"IES file loaded, {iesBytes.Length} bytes"
            );
        }
        catch (Exception ex)
        {
            StatusMessage = $"Error: {ex.Message}";
        }
    }

    private void ConvertToTm33()
    {
        StatusMessage = "Ready to convert to TM-33 (logic pending)";
    }
}
